#!/bin/bash
set -euo pipefail

{{ template "script_header.sh" . }}

# Create environment directory structure
log_info "Setting up environment directory structure..."

# Create directories
mkdir -p "$HOME/.config/env"
mkdir -p "$HOME/.local/bash"

# Copy .env files if they don't exist yet
if [ ! -f "$HOME/.config/env/.env" ]; then
    cp "{{ .chezmoi.sourceDir }}/dot_config/env/dot_env" "$HOME/.config/env/.env"
fi

# Copy OS-specific .env file
case "$(uname)" in
  Darwin)
    if [ ! -f "$HOME/.config/env/.env.macos" ]; then
        cp "{{ .chezmoi.sourceDir }}/dot_config/env/dot_env.macos" "$HOME/.config/env/.env.macos"
    fi
    ;;
  Linux)
    if [ ! -f "$HOME/.config/env/.env.linux" ]; then
        cp "{{ .chezmoi.sourceDir }}/dot_config/env/dot_env.linux" "$HOME/.config/env/.env.linux"
    fi
    ;;
esac

# Create a .env.local file if it doesn't exist
if [ ! -f "$HOME/.config/env/.env.local" ]; then
    cp "{{ .chezmoi.sourceDir }}/dot_config/env/dot_env.local.example" "$HOME/.config/env/.env.local"
    log_info "Created .env.local from example. You may want to customize this file."
fi

log_success "Environment directory structure set up successfully!"
echo "-------------------------------------------------------------------------------------------"
